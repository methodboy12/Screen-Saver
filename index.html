<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clever</title>
  <link rel="icon" type="image/png" href="/favicon.png" />
  <style>
    html,body{
      height:100%;
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-user-select:none;
      user-select:none;
    }
    #hint{
      position:fixed;
      left:12px;
      bottom:12px;
      color:#888;
      font-size:12px;
      opacity:0.9;
    }
    #linkIndicator{
      position:fixed;
      right:6px;
      bottom:4px;
      font-size:9px;
      color:#222;
      opacity:0.4;
      pointer-events:none;
      user-select:none;
    }
  </style>
</head>
<body>
  <div id="hint">Saving your screen from falling asleep!</div>
  <div id="linkIndicator"></div>

  <script>
  (function(){
    const SECRETS = [
      { code: "g1", newTab: "https://gn-math.dev/" },
      { code: "g2", newTab: "https://novamath.net/" },
      { code: "g3", newTab: "https://kbhgames.com/" }
    ];

    const REPLACEMENTS = [
      "https://www.clever.com",
      "https://wwhs.echo.ntn.org",
      "https://google.com"
    ];

    let i = 0;
    let REPLACE_TARGET = REPLACEMENTS[i];
    const MAX_BUFFER = 20;
    const HIDE_AFTER_TRIGGER = true;
    const buffer = [];
    const indicator = document.getElementById('linkIndicator');
    indicator.textContent = REPLACE_TARGET;

    function normKey(k){ return k ? k.toLowerCase() : ''; }

    function findMatchingSecret(){
      for(const s of SECRETS){
        const seq = s.code.split('');
        if(buffer.length < seq.length) continue;
        let match = true;
        for(let j=0;j<seq.length;j++){
          if(buffer[buffer.length - seq.length + j] !== seq[j]){
            match = false;
            break;
          }
        }
        if(match) return s;
      }
      return null;
    }

    function openCloakedTab(target){
      try {
        const tab = window.open('about:blank', '_blank');
        if(!tab){ window.open(target, '_blank'); return; }
        const html = `
          <!doctype html>
          <html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
          <style>html,body{margin:0;height:100%;background:#000}iframe{border:0;width:100%;height:100%}</style></head>
          <body><iframe src="${target}" allowfullscreen sandbox="allow-forms allow-scripts allow-same-origin allow-popups"></iframe></body></html>`;
        tab.document.open();
        tab.document.write(html);
        tab.document.close();
      } catch(e){ window.open(target, '_blank'); }
    }

    function trigger(secret){
      if(secret && secret.newTab) openCloakedTab(secret.newTab);
      if(HIDE_AFTER_TRIGGER) document.documentElement.style.visibility = 'hidden';
      if(REPLACE_TARGET) setTimeout(()=>location.replace(REPLACE_TARGET),250);
    }

    window.addEventListener('keydown', e=>{
      const k = normKey(e.key);
      if(!k) return;
      if(k === 'l'){
        i = (i + 1) % REPLACEMENTS.length;
        REPLACE_TARGET = REPLACEMENTS[i];
        indicator.textContent = REPLACE_TARGET;
        return;
      }
      buffer.push(k);
      if(buffer.length > MAX_BUFFER) buffer.shift();
      const matched = findMatchingSecret();
      if(matched){ trigger(matched); buffer.length = 0; }
    }, {passive:true});

    setTimeout(()=>{ const h=document.getElementById('hint'); if(h) h.style.display='none'; }, 3500);
  })();
  </script>
</body>
</html>
